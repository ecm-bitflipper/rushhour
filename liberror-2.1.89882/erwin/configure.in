dnl -*- Mode: M4 -*-
dnl
dnl Author: Henrik Theiling
dnl
dnl Description: input for autoconf to create the configuration script
dnl              for the library
dnl
dnl @@Begin: Licencing and Copying@@
dnl
dnl Copyright (c) Henrik Theiling
dnl Licence Version 2, Special Version for Erwin.
dnl
dnl The term 'this software' used in the following, additional to its
dnl usual usage, also includes the instantiated source files generated by
dnl tools of this package.
dnl
dnl This software is provided 'as-is', without warranty of any kind,
dnl express or implied.  In no event will the authors or copyright holders
dnl be held liable for any damages arising from the use of this software.
dnl
dnl Permission is granted to anyone to use this software for any purpose,
dnl including commercial applications, and to alter it and redistribute it
dnl freely, subject to the following restrictions:
dnl
dnl 1. The origin of this software must not be misrepresented; you must
dnl not claim that you wrote the original software. If you use this
dnl software in a product, an acknowledgment in the product documentation
dnl would be appreciated.
dnl
dnl 2. Altered source versions must be plainly marked as such, and must
dnl not be misrepresented as being the original software.
dnl
dnl 3. You must not use any of the names of the authors or copyright
dnl holders of the original software for advertising or publicity
dnl pertaining to distribution without specific, written prior permission.
dnl
dnl 4. If you change this software and redistribute parts or all of it in
dnl any form, you must make the source code of the altered version of this
dnl software available.  As an exception, files that were generated by
dnl tools of this package may be used freely, including modification.
dnl
dnl 5. This notice must not be removed or altered from any source
dnl distribution.
dnl
dnl This licence is governed by the Laws of Germany.  Disputes shall be
dnl settled by Saarbruecken City Court.
dnl
dnl @@End: Licencing and Copying@@
dnl

AC_INIT(include/error/erwin/asm.h)

builtin(include, ../acerwin.m4)

ER_ARG_ENABLE_OPT
dnl AC_ARG_ENABLE(printcrl,[  --disable-printcrl      disable ability to print CRL files])
dnl what??

dnl Checks for programs.
dnl ER_ARG_WITH_CXX
dnl ER_ARG_WITH_CC

if test "x$with_cxx" != xno && test "x$with_cxx" != xyes ; then
    with_cxx=yes
fi

if test "x$with_cc" != xno && test "x$with_cc" != xyes ; then
    with_cc=yes
fi

builtin(include, ../configure-shellvars)
builtin(include, ../configure-basics)

ER_ARG_ENABLE_RELEASE
ER_ARG_ENABLE_NDEBUG

if test "x0" = x1 && test "x$with_cxx" != xno; then
    AC_LANG_CPLUSPLUS
    AC_CHECK_LIB(error, eprintf)
    AC_LANG_C
fi

define(ASK,
[
   echo -n [$1]
   read a
   if test x${a} = x ; then
      [$2]=$3
   else
       if test x${a} = xy ; then
          [$2]=yes
       else
           if test x${a} = xyes ; then
              [$2]=yes
           else
              [$2]=no
           fi
       fi
   fi
   echo "    CHECK: You answered $[$2]."
])

dnl Checks for typedefs, structures, and compiler characteristics.
if test x${ASK_CROSS} = x1; then
   ASK_CROSS="${cross_compiling}"
fi

if test x${ASK_CROSS} = xyes ; then
    echo "**********************************************************************"
    echo "I have some questions about the cross compiler."
    echo

    ASK("Is char unsigned (y/N)? ", ac_cv_c_char_unsigned, no)
    if test $ac_cv_c_char_unsigned = yes && test "$GCC" != yes; then
       AC_DEFINE(__CHAR_UNSIGNED__, 1, [Whether char is unsigned.])
    fi

    ASK("Is the target a bigendian machine (y/N)? ", ac_cv_c_bigendian, no)
    if test $ac_cv_c_bigendian = yes; then
       AC_DEFINE(WORDS_BIGENDIAN, 1, [Whether machine is big endian.])
    fi

    ASK("Please enter sizeof(short) (default: 2): ", ac_cv_sizeof_short, 2)
    AC_DEFINE_UNQUOTED(SIZEOF_SHORT,$ac_cv_sizeof_short,[Size of short])

    ASK("Please enter sizeof(int) (default: 4): ", ac_cv_sizeof_int, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_INT,$ac_cv_sizeof_int,[Size of int])

    ASK("Please enter sizeof(long) (default: 4): ", ac_cv_sizeof_long, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_LONG,$ac_cv_sizeof_long,[Size of long])

    ASK("Please enter sizeof(void*) (default: 4): ", ac_cv_sizeof_voidp, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_VOIDP,$ac_cv_sizeof_voidp,[Size of void*])

    ASK("Please enter sizeof(float) (default: 4): ", ac_cv_sizeof_float, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_FLOAT,$ac_cv_sizeof_float,[Size of float])

    ASK("Please enter sizeof(double) (default: 8): ", ac_cv_sizeof_double, 8)
    AC_DEFINE_UNQUOTED(SIZEOF_DOUBLE,$ac_cv_sizeof_double,[Size of double])

    echo "For the following size operands, you may enter 0 if your system does not"
    echo "support that type.  If \`long long' is called differently and you want to"
    echo "use it anyway, you must create your own config.h (there are examples)."

    ASK("Please enter sizeof(long long) (default: 8): ", ac_cv_sizeof_long_long, 8)
    AC_DEFINE_UNQUOTED(SIZEOF_LONG_LONG,$ac_cv_sizeof_long_long,[Size of long long])

    ASK("Please enter sizeof(long double) (default: 10): ", ac_cv_sizeof_long_double, 10)
    AC_DEFINE_UNQUOTED(SIZEOF_LONG_DOUBLE,$ac_cv_sizeof_long_double,[Size of long double])

    ASK("Please enter sizeof(wchar_t) (default: 4): ", ac_cv_sizeof_wchar_t, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_WCHAR_T,$ac_cv_sizeof_wchar_t,[Size of wchar_t])
    AC_DEFINE_UNQUOTED(SIZEOF__WCHAR_T,0,[not used])
    AC_DEFINE_UNQUOTED(SIZEOF___WCHAR_T,0,[not used])

    ASK("Please enter sizeof(wint_t) (default: 4): ", ac_cv_sizeof_wint_t, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_WINT_T,$ac_cv_sizeof_wint_t,[Size of wint_t])
    AC_DEFINE_UNQUOTED(SIZEOF__WINT_T,0,[not used])
    AC_DEFINE_UNQUOTED(SIZEOF___WINT_T,0,[not used])

    ASK("Please enter sizeof(size_t) (default: 4): ", ac_cv_sizeof_size_t, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_SIZE_T,$ac_cv_sizeof_size_t,[Size of size_t])

    ASK("Please enter sizeof(ptrdiff_t) (default: 4): ", ac_cv_sizeof_ptrdiff_t, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_PTRDIFF_T,$ac_cv_sizeof_ptrdiff_t,[Size of ptrdiff_t])

    ASK("Please enter sizeof(intmax_t) (default: 4): ", ac_cv_sizeof_intmax_t, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_INTMAX_T,$ac_cv_sizeof_intmax_t,[Size of intmax_t])

    ASK("Please enter sizeof(int64_t) (default: 8): ", ac_cv_sizeof_intmax_t, 8)
    AC_DEFINE_UNQUOTED(SIZEOF_INT64_T,$ac_cv_sizeof_int64_t,[Size of int64_t])

    ASK("Please enter sizeof(uint64_t) (default: 8): ", ac_cv_sizeof_intmax_t, 8)
    AC_DEFINE_UNQUOTED(SIZEOF_UINT64_T,$ac_cv_sizeof_int64_t,[Size of uint64_t])

    ASK("Please enter sizeof(void(*)(void)) (default: 4): ", ac_cv_sizeof_void_p__void_, 4)
    AC_DEFINE_UNQUOTED(SIZEOF_VOID_P__VOID_,$ac_cv_sizeof_void_p__void_,[Size of void(*)(void)])

    echo
    echo "Thanks a lot!"
    echo "**********************************************************************"
else
    AC_C_CHAR_UNSIGNED
    AC_C_BIGENDIAN

    dnl Defaults are for a typical 32 bit machine:
    AC_CHECK_SIZEOF(short,         2)
    AC_CHECK_SIZEOF(int,           4)
    AC_CHECK_SIZEOF(long,          4)
    AC_CHECK_SIZEOF(void*,         4)
    AC_CHECK_SIZEOF(float,         4)
    AC_CHECK_SIZEOF(double,        8)
    AC_CHECK_SIZEOF(long long,     8)
    AC_CHECK_SIZEOF(long double,   16)
    ER_CHECK_SIZEOF_WITH_CODE(void(*)(void), [],       4)
    ER_CHECK_SIZEOF_INCLUDE(int64_t,       [inttypes.h], 8)
    ER_CHECK_SIZEOF_INCLUDE(uint64_t,      [inttypes.h], 8)
    ER_CHECK_SIZEOF_INCLUDE(size_t,        [stdlib.h],   4)
    ER_CHECK_SIZEOF_INCLUDE(ssize_t,       [stdlib.h],4)
    ER_CHECK_SIZEOF_INCLUDE(wchar_t,       [wchar.h],    4)
    ER_CHECK_SIZEOF_INCLUDE(_wchar_t,      [wchar.h],    4)
    ER_CHECK_SIZEOF_INCLUDE(__wchar_t,     [wchar.h],    4)
    ER_CHECK_SIZEOF_INCLUDE(wint_t,        [wchar.h],    4)
    ER_CHECK_SIZEOF_INCLUDE(_wint_t,       [wchar.h],    4)
    ER_CHECK_SIZEOF_INCLUDE(__wint_t,      [wchar.h],    4)
    ER_CHECK_SIZEOF_INCLUDE(ptrdiff_t,     [stddef.h],   4)
    ER_CHECK_SIZEOF_INCLUDE(intptr_t,      [inttypes.h], 4)
    ER_CHECK_SIZEOF_INCLUDE(intmax_t,      [inttypes.h], 8)
fi


ER_BROKEN_CTYPE

AC_SUBST(MORE_CPPFLAGS)
AC_SUBST(MORE_CXXFLAGS)
AC_SUBST(MORE_CFLAGS)
AC_SUBST(MORE_LDFLAGS)
AC_SUBST(LESS_CPPFLAGS)
AC_SUBST(LESS_CXXFLAGS)
AC_SUBST(LESS_CFLAGS)
AC_SUBST(LESS_LDFLAGS)

mkdir lib >/dev/null 2>&1
if test ! -d include/error/erwin; then
    mkdir  include/error >/dev/null 2>&1
    mkdir  include/error/ >/dev/null 2>&1
    mkdir  include/error/erwin >/dev/null 2>&1
fi

AC_CONFIG_HEADER(include/error/erwin/config.h)

AC_OUTPUT(Makefile Makefile.cross)
